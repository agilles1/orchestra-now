<div class='wrapper'>
    <h2> New Service </h2>
    <% @service.errors.full_messages.each do |error| %>
        <p><i><%=error%><i></p>
    <% end %>

    <%= form_for @service do |f| %>
        <p><%= f.label :Start %>
        <%= f.datetime_select :start_time %></p>
        <p> <%= f.label :End %>
        <%= f.datetime_select :end_time %> </p>
        <p><%= f.label :Concert %>
        <%= f.check_box :concert %></p>
        
        <h3>Repertoire</h3> 

        <table>
            <tr>
                <th>Order</th>
                <th>Work</th>
            </tr>
            <%= f.fields_for :service_work, @service.service_works.build do |w| %>
                <tr>
                    <td><%= w.number_field :order, {:name => 'service[service_works_attributes][order][]'}  %> </td>
                    <td><%= w.grouped_collection_select(:work_id, Composer.all, :works_in_alpha, :full_name, :id, :title, {:prompt => "Please Select a Work", :include_blank => false}, {:name => 'service[service_works_attributes][work_id][]'}) %></td>
                </tr>
            <%end%>

            <%= f.fields_for :service_work, @service.service_works.build do |w| %>
                <tr>
                    <td><%= w.number_field :order, {:name => 'service[service_works_attributes][order][]'}  %> </td>
                    <td><%= w.grouped_collection_select(:work_id, Composer.all, :works_in_alpha, :full_name, :id, :title, {:prompt => "Please Select a Work", :include_blank => false}, {:name => 'service[service_works_attributes][work_id][]'}) %></td>
                </tr>
            <%end%>

            <%= f.fields_for :service_work, @service.service_works.build do |w| %>
                <tr>
                    <td><%= w.number_field :order, {:name => 'service[service_works_attributes][order][]'}  %> </td>
                    <td><%= w.grouped_collection_select(:work_id, Composer.all, :works_in_alpha, :full_name, :id, :title, {:prompt => "Please Select a Work", :include_blank => false}, {:name => 'service[service_works_attributes][work_id][]'}) %></td>
                </tr>
            <%end%>
        </table><br>
        <%= f.submit %>
    <% end %>
</div>

grouped_collection_select(object, method, collection, group_method, group_label_method